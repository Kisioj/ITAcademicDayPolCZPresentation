<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>C# + Gothic + ANTLR4</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
		
		<!-- From dziejekhorinis.org -->
		<link rel="stylesheet" href="css/hero-artwork.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
		<style>
			.reveal section img.clear { background:none; border:none; box-shadow:none; }
		</style>
	</head>
	<body>
		<div id="hero-artwork">
			<div class="background"></div>
			<div class="smoke"></div>
			<div class="first-plane"></div>
		</div>
		<img src="logo-horizontal.png" id="logo" alt="Gothic II Dzieje Khorinis">
		
		<div class="reveal">
			<div class="slides">
				<section class="stack">
					<section data-background-transition="slide">
						<h3>C# + Gothic + ANTLR4 -<br/>we're making the compiler!</h3><br/><br/>

						<aside class="notes">
							KJ: Cze wszystkim, przyjechalimy dzisiaj do was z tematem C# + Gothic + ANTLR4, czyli tworzymy kompilator.
							Opowiemy wam dzisiaj o projekcie kompilatora, nad kt贸rym pracujemy po godzinach. Mamy nadzieje, 偶e
							temat was zainteresuje, mo偶e nawet na tyle, 偶e bdziecie chcieli doczy do projektu i doo偶y do niego swoj cegiek.
							Zanim zaczniemy temat kompilatora, to opowiemy kr贸tko o sobie i o projekcie Dzieje Khorinis.
							Zaczynajmy.
						</aside>
					</section>
					
					<section data-transition="zoom">
						<h2 style="text-align:left">About us</h2><br>

						<h4 class="fragment fade-in" style="text-align:left">Artur Kasperek</h4>
						
						<div class="sl-block" data-block-type="text">
							<div class="sl-block-content" data-placeholder-tag="p" data-placeholder-text="Text" style="z-index: 12; line-height: 1.95;" data-has-line-height="">
								<ul>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">Dzieje Khorinis programmers coordinator</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">JS, TS Fullstack Freelance developer</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">Computer Science student</li>
								</ul>
							</div>
						</div>
						<aside class="notes">
							AK: Mam na imi Artur Kasperek, pochodz z Zawiercia. Na co dzie mieszkam w Gliwicach, w akademiku, jestem studentem Polsl.
							Pracuje w IT od ponad 3 lat, pod koniec gimnazjum zainteresowaem si programowaniem w c++, potem poszedem na studia
							informatyczne, po pierwszym semestrze zaczem pracowa, zaczynaem jako sta偶ysta robic frontend w angularze1.
							Nastpnie zacz si zajmowa tak偶e backendem i tak staem si fullstackiem. Ostatnie miesice spdzam
							na projekcie kt贸rego celeme jest dostarczenie softwaru dla agent贸w nieruchomici ze stan贸w.

							Staram si bra udzia w r贸藕nych meetupach programistycznych, nie tylko jako suchacz by cay czas si
							doskonali
						</aside>
					</section>
					
					
					<section data-transition="zoom">
						<h2 style="text-align:left">About us</h2><br>

						<h4 class="fragment fade-in" style="text-align:left">Krzysztof Jura &lt;<a href="kisioj@gmail.com" target="_top">kisioj@gmail.com</a>&gt;</h4>
						
						<div class="sl-block" data-block-type="text">
							<div class="sl-block-content" data-placeholder-tag="p" data-placeholder-text="Text" style="z-index: 12; line-height: 1.95;" data-has-line-height="">
								<ul>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">Software developer</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">Programming teacher (C, C++, Python)</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">PyCzest  founder (<a href="https://fb.com/pyczest" target="_top">fb.com/pyczest</a>)</li>
								</ul>
							</div>
						</div>
						<aside class="notes">
							KJ: Ja nazywam si Krzysztof Jura, przyjechaem do was z Czstochowy, z Parkitki, czyli miaem do niedaleko.

							Je偶eli chodzi o mnie to ja, programuj od 2007 roku, zaczynaem hobbistycznie od pisania sieciowych gier komputerowych 2D, a od ponad 5 lat pracuj w zawodzie, jako programista.
							G贸wnie zajmuj si tworzeniem aplikacji internetowych, zar贸wno po stronie backendu, kt贸ry pisz w Pythonie, jak i po stronie frontendu, kt贸ry oczywicie pisz w JavaScripcie.
							W og贸le, bardzo mo偶liwe, 偶e jaka cz z was korzysta na codzie z jaki system贸w nad kt贸rymi w przeszoci pracowaem, np. z systemu bankowego banku PKO BP.
							
							Opr贸cz tego, 偶e programuj to od lat dorywczo zajmuj si nauczaniem programowania, zar贸wno prywanie jak i w szkoach programowania.

							Jestem te偶 zao偶ycielem fanpage'a Czstochowskiej Spoecznoci U偶ytkownik贸w jzyka Python. Obecnie na tym fanpage'u nic si nie dzieje, ale mamy w planach organizacje spotka programist贸w Pythona, a w najbli偶szej przyszoci bdziemy organizowali darmowe warsztaty z programowania w jzyku Python. Warsztaty bd dla ka偶dego niezale偶nie od pci, wieku, rasy, wyznania, orientacji seksualnej czy pogld贸w politycznych, wic ka偶dego zainteresowanego zapraszam do polubienia fanpage'a i oczekiwania na dalsze informacje.
						
							I to by byo na tyle je偶eli chodzi o nas prywatnie, natomiast chciabym jeszcze opowiedzie o projekcie w kt贸rym oboje z Arturem bierzmy udzia.
						</aside>
					</section>
					
					<section data-transition="slide">
						<img src="logo-horizontal.png" class="logo" style="max-height: 250px;">
						<img src="dkscreen.jpg" style="max-height: 300px;">
						
						<aside class="notes">
							KJ: Projekt ten nazywa si Gothic II Dzieje Khorinis. Bardzo mo偶liwe, 偶e ju偶 syszelicie t nazw bo jest o nas do gono.
							Tak w skr贸cie: robimy moda do kultowej gry o nazwie Gothic II. W naszym zespole mamy kilkadziesit os贸b, w tym m.in. programist贸w, scenarzyst贸w, grafik贸w, animator贸w i pewnie jeszcze kilka innych typ贸w os贸b. Natomiast nadal szukamy ludzi, wic je偶eli kto jest chtny nas wesprze to mo偶emy pogada o tym po tej prezentacji. Warto doda, 偶e projekt jest non profit, to znaczy nie dostajemy 偶adnych pienidzy za prac; po prostu pracujemy bo chcemy zrobi co fajnego.
							
							Je偶eli chodzi o histori projektu to pomys na zrobienie moda powsta w 2008 roku, ale dopiero pod koniec roku 2015 rozpoczy si nad nim prace.
							Natomiast zgromadzenie zespou w takim ksztacie w jakim mniej wicej teraz jest to w zasadzie kwestia ostatniego roku.
							
							Z takich ciekawostek to: do naszego moda gos贸w udzielaj profesjonalni aktorzy gosowi, w tym r贸wnie偶 Ci, kt贸rzy podkadali gos postaciom z oryginalnej wersji gry.
							
							Opr贸cz samego moda, w naszym zespole pracujemy r贸wnie偶 nad narzdziami zwizanymi z modowaniem Gothica. G贸wnym jzykiem, kt贸ry wykorzystujemy w tych narzdziach jest C#, a o samych narzdziach opowie wam Artur.
							
						</aside>
					</section>
				</section>
				
				<section data-transition="slide">
					<h3 style="text-align:left">Tools</h3><br>
					<div class="sl-block" data-block-type="text">
						<div class="sl-block-content" style="z-index: 12; line-height: 1.95;">
							<ul>
								<li class="fragment fade-in-then-semi-out" style="text-align:left">3D World Editor</li>
								<li class="fragment fade-in-then-semi-out" style="text-align:left">Mod Package Builder</li>
								<li class="fragment fade-in-then-semi-out" style="text-align:left">Translation Tool</li>
								<li class="fragment fade-in-then-semi-out" style="text-align:left">Daedalus Compiler</li>
							</ul>
						</div>
					</div><br>
					
					<aside class="notes">
							AK: Narzdzi, kt贸re tworzymy jest do du偶o, natomiast takie g贸wne 3 narzdzia to przede wszystkim:
							
							- Edytor wiat贸w, kt贸ry ma w zao偶eniu by du偶o bardziej rozbudowanym i dopracowanym edytorem ni偶 ten doczony do Gothica. Ten Gothicowy wiecznie si zawiesza, chodzi bardzo topornie i czc spoecznoci generalnie klnie na niego.

							- Kolejnym naszym projektem jest narzdzie do budowania paczki z modem, kt贸re zbiera do kupy cay kod projektu, mapy, modele i inne rzeczy i buduje z nich paczk o oczekiwanym przez Gothica formacie.

							- Pracujemy tak偶e nad narzdziem kt贸re pozwoli w atwiejszy spos贸b doda lokalizacje jzykowe, obecnie by doda now wersj jzykow tumacz musi grzeba bezporednio w skryptach i np podmienia literay, co grozi bugami w danej wersji jzykowe

							- No i ostatnim narzdziem jest Kompilator jzyka Daedalus, o kt贸rym dzisiaj wam troszk wicej opowiemy.
					</aside>
				</section>
				
				
				
				
				<section class="stack">
					<section data-transition="slide">
						<h3>Daedalus</h3><br>
						<img class="fragment fade-in" src="wtfmeme.png" style="max-height: 300px;">
						
						<aside class="notes">
							Pytanie do publicznoci: czy kto z was w og贸le sysza o takim jzyku jak Daedalus?
						</aside>
					</section>
					
					<section data-transition="slide">
						<h3 style="text-align:left">Daedalus</h3><br>
						<div class="sl-block" data-block-type="text">
							<div class="sl-block-content" style="z-index: 12; line-height: 1.95;">
								<ul>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">Gothic I and II scripting language</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">has C-like syntax</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">compiled to Daedalus bytecode</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">have externals which call engine functions directly</li>
								</ul>
							</div>
						</div><br>
						
						<aside class="notes">
							Daedalus kt贸rego nazwa pochodzi od mitycznego Dedala to po prostu jzyk skryptowy gier Gothic I i Gothic II, czyli jzyk w kt贸rym pisze si mody do tych gier.
							
							Jego skadnia zostaa zainspirowana skadni jzyka C co wida ju偶 na 1 rzut oka.
							
							A kod tego jzyka jest kompilowany do kodu bajtowego, wykonywanego w trakcie gry przez maszyn wirtualn zawart w grze Gothic.

							Za pomoc externali jest mo偶liwe wywoanie r贸偶nych funkcji kt贸re s zaimplementowane na poziomie silnika, np logi
							
							<!--
							M贸wimy 偶e dziki skryptom w D komuniukujemy si z silnkiem gry,
							w D istniej internale do silnika, np AI_output kt贸re steruj zachowaniem
							silnika. Typowa architektura jak dla gier koo 2000 roku, Quake 3 podobnie dziaa ( C QUAKE )
								-->
						</aside>
					</section>

					
					<section data-background-transition="slide">
						<pre><code data-trim data-noescape>
instance PC_Thief_DI(Npc_Default)
{
  name[0] = "Diego";
  guild = GIL_NONE;
  npcType = NPCTYPE_FRIEND;
  aivar[AIV_ToughGuy] = TRUE;
  B_SetAttributesToChapter(self,6);
  fight_tactic = FAI_HUMAN_MASTER;
  EquipItem(self,ItMw_1h_Sld_Sword);
  daily_routine = Rtn_Start_31;
  ...
};
		</code></pre>

						<aside class="notes">
							Tutaj widzicie przykadowy kod w jzyku Daedalus. Jest to kod definiujcy instancj NPCta, kt贸rego p贸藕niej w trakcie gry bdziemy mogli spotka na mapie.
							
							Ustalamy tutaj imie tego NPCta, jego model 3D, zachowanie, statystyki i inne parametry.
						</aside>
					</section>
					
					
					
					<section data-background-transition="slide">
						<pre><code data-trim data-noescape style="overflow: hidden;">
func void DIA_MIL_6_STANDARD_Info()
{
  AI_Output(other,self,"DIA_MIL_15_00");  //Co sycha?
  if(Kapitel == 1)
  {
    AI_Output(self,other,"DIA_MIL_06_01"); //W miecie coraz wicej szumowin.
    AI_Output(self,other,"DIA_MIL_06_02"); //Wszdzie coraz wicej zodziei. Lord Andre podejrzewa nawet, 偶e cae to zamieszanie jest sprawk gangu.
    AI_Output(self,other,"DIA_MIL_06_03"); //Niedawno przetrzsnlimy dokadnie ca dzielnic portow, ale niczego nie znale藕limy.
  }
  else if(Kapitel == 2)
  {
    AI_Output(self,other,"DIA_MIL_06_04"); //Wyglda na to, 偶e problem bandyt贸w mamy ju偶 z gowy. Ataki stay si ostatnimi czasy rzadkoci.
  };
};
		</code></pre>

						<aside class="notes">
							Kolejny przykad kodu przedstawia funkcj dialogow zawierajc kwestie wypowiadane przez nasz posta oznaczon przez self oraz przez posta z kt贸r rozmawiamy oznaczon przez other.
						</aside>
					</section>
					
					
					<section data-transition="slide">
						<h3>Daedalus Compiler</h3><br>
						<img class="fragment fade-in" src="butwhy.gif" style="height: 300px; width: 550px; object-fit: cover;">
						
						<aside class="notes">
							No dobra, wiemy czym jest jzyk Daedalus, ale pytanie brzmi: dlaczego w og贸le chcielimy stworzy nowy kompilator tego jzyka?
							
							Powod贸w jest kilka.
							
							<!-- Skrypter nie mo偶e szybko przekompilowa rzeczy bez odpalania gry, musi przewin intro
							Nie mo偶emy przez to atwo postawi stagingu kt贸ry by testowa automatycznie czy
							skrypty s kompilowanlne w naszym pipeline -->
							
							<!-- Kompilator bdzie dopenieniem narzdzia do budowania gry ( robocza nazwa gothic mod composer ).
							Dziki temu nawet niedowiadczony skrypter bdzie m贸g w prosty spos贸b zacz zabaw z modowaniem
							gothica -->
							
							Jednym z g贸wnych powod贸w jest to, 偶e oryginalny kompilator jest wbudowany w gr Gothic i 偶eby skompilowa skrypty trzeba t gr najpierw uruchomi - co jest do niefajne,
							bo po pierwsze trzeba mie zainstalowanego Gothica, a po drugie, po prostu gorzej si z takiego kompilatora korzysta - no bo trzeba za ka偶dym razem czeka na uruchomienie gry, a potem wyj z gry.
							
							Kolejna sprawa to jest to, 偶e bdy wywietlane przez oryginalny kompilator s czsto do niejasne i enigmatyczne i w naszym kompilatorze chcielibymy to zrobi lepiej.
							
							No a poza tym sam jzyk Daedalus w wersji dla oryginalnego kompilatora jest jzykiem do mocno ograniczonym, wic mamy pomys aby nasz kompilator potrafi obsugiwa bardziej rozbudowan wersj tego jzyka, ale zachowujc kompatybilno wsteczn , to znaczy, 偶e oryginalny kod w jzyku Daedalus r贸wnie偶 dziaaby u nas bez problemu.
						</aside>
					</section>
					

					
					<section data-transition="slide">
						<h3 style="text-align:left">Daedalus flaws</h3>
						<div class="sl-block" data-block-type="text">
							<div class="sl-block-content" style="z-index: 12; line-height: 1.95;">
								<ul>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">no for or while loop</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">has classes but no methods</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">requires ; after }</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">constants can be modified</li>
								</ul>
							</div>
						</div>
						
						<aside class="notes">
							Jakie s te ograniczenia jzyka Daedauls, kt贸rych chcielibymy si pozby w naszej wersji jzyka?
							
							Jest ich generalnie bardzo du偶o, a kilka takich pierwszych z brzegu, kt贸re od razu przychodz na myl to np. to, 偶e:
							
							- w jzyku Daedalus nie ma ptli, ani for, ani while, ani foreach, ani 偶adnej innej, natomiast w naszej wersji jzyka chcemy je doda
							
							- kolejne ograniczenie to to, 偶e w Daedalusie istniej klasy, natomiast nie mog posiada one metod, wic s de facto tylko stukturami danych i chcielibymy to zmieni

							- Kolejna sprawa to to, 偶e oryginalny kompilator wymaga umieszczania rednik贸w po zamykajcych nawiasach wsatych, co mo偶e by do wkurzajce dla programist贸w innych jzyk贸w nieprzyzwyczajonych do takich rzeczy.
							
							- r贸wnie偶 dziwn rzecz jest to, 偶e stae mo偶na w jzyku Daedalus modyfikowa, a od zmiennych r贸偶ni si one tym, 偶e nie s zapisywane w save'ach. My raczej nie bdziemy chcieli dawa programistom mo偶liwoci zmiany wartoci staych.

							
							Genealnie tych ogranicz jzyka Daedalus jest du偶o du偶o wicej, wic naprawd mo偶emy ten jzyk bardzo ulepszy i mam nadziej, 偶e nam si to uda.
							
							No dobra, wr贸my do g贸wnego tematu: czyli do tematu tworzenia kompilatora. Ale najpierw zadam pytanie: czy ka偶dy z was wie czym dokadnie jest kompilator? Pewnie nie ka偶dy.
						</aside>
					</section>
				</section>

				<section class="stack">
					<section data-transition="slide">
						<h3>Compiler</h3>
						<p class="fragment fade-in">A compiler is computer software that transforms computer code written in one programming language (the source language) into another programming language (the target language).</p>
						
						<aside class="notes">
							A wic pozw贸lcie, 偶e przedstawie wam definicje z angielskiej wikipedii, kt贸ra m贸wi, 偶e kompilator to jest program, kt贸ry zamienia kod napisany w jednym jzyku programowania na kod w innym jzyku programowania.
							
							Zazwyczaj jednak jak m贸wimy o kompilatorze  to mamy na myli co w stylu kompilatora np. jzyka C, czyli chodzi nam o program, kt贸ry zamienia kod 藕r贸dowy na kod maszynowy, czyli instrukcje zrozumiae dla procesora naszego komputera,

							albo czsto te偶 chodzi nam o program, kt贸ry zamienia kod 藕r贸dowy na kod bajtowy, kt贸ry potem jest wykonywany przez maszyn wirtualn i tak jest np. w przypadku np. Javy albo wanie jzyka Daedalus.
						</aside>
					</section>
					
					

					
					
					
					<section data-transition="slide">
						<h3>How does the compiler work?</h3>
						
						<aside class="notes">
							No dobra, ale jak kompilator dziaa pod spodem? Ot贸偶 nale偶y zacz od tego, 偶e kompilator to taki program, kt贸ry jak sama nazwa wskazuje, potrafi wykona proces kompilacji jakiego kodu 藕r贸dowego - czyli ten proces zamiany kodu 藕r贸dowego na kod zrozumiay przez procesor lub maszyn wirtualna.
							
							Proces kompilacji skada si z kilku g贸wnych krok贸w. Krok贸w tych mo偶e by wicej, lub mniej, w zale偶noci od kompilatora, natomiast podstawowe kroki, kt贸re wykorzystujemy w naszym kompilatorze s nastpujce:
						</aside>
					</section>
					
					
					<section data-transition="slide">
						<h3>Compilation</h3>
						<div class="fragment fade-in">
							<p style="text-align:left; margin-bottom: 30px; margin-top: 30px;">1. lexical analysis</p>
							<p style="text-align:left; margin-bottom: 30px; margin-top: 30px;">2. parsing (syntactic analysis)</p>
							<p style="text-align:left; margin-bottom: 30px; margin-top: 30px;">3. semantic analysis, IR generation</p>
							<p style="text-align:left; margin-bottom: 30px; margin-top: 30px;">4. code generation</p>
						</div><br>

						<aside class="notes">
		
						</aside>
					</section>
					
					<!--
					
					<section data-transition="slide">
						<h3>Compilation steps</h3>
						<div class="sl-block" data-block-type="text">
							<div class="sl-block-content" style="z-index: 12; line-height: 1.95;">
								<ul>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">preprocessing</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">lexical analysis</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">parsing</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">semantic analysis</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">intermediate form generation</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">optimization</li>
									<li class="fragment fade-in-then-semi-out" style="text-align:left">code generation</li>
								</ul>
							</div>
						</div>
						
						<aside class="notes">
		
						</aside>
					</section>
					-->
					
					<!-- - Pierwszym krokiem jest tkz. preprocessing, czyli przetworzenie kodu 藕r贸dowego za pomoc dyrektyw preprocesora. Je偶eli kto z was pisa kod w C albo w C++ to chodzi o komendy zaczynajce si od hashtaga, np. define albo include. W naszym kompilatorze p贸ki co tego kroku nie ma i najprawdopodobniej nie bdzie. -->
					
					<section data-transition="slide">
						<h3>1. Lexical analysis</h3>
						<div style="align-items: center; display: flex;">
						
						<pre class="fragment fade-in" style="width:35%; float:left;"><code data-trim data-noescape style="overflow: hidden;">
func void testFunc() {
  var int x;
  x = HLP_Random(100);
  if (x >= 50) {
    Print("You win!");
  } else {
    Print("You lose");
  };
};
			</code></pre>
			
			<p class="fragment fade-in" style="float: left;margin-left: 2%;margin-right: 1%;padding: 0; font-size:200%"></p>
			
			<pre class="fragment fade-in" style="width:52%; float:left; font-size: 0.50em;"><code data-trim data-noescape style="overflow: hidden;">
Token('func', &lt;FUNC>&gt;
Token('void', &lt;VOID>&gt;
Token('testFunc', &lt;IDENTIFIER>&gt;
Token('(', &lt;OPEN_PAREN>&gt;
Token(')', &lt;CLOSE_PAREN>&gt;
Token('{', &lt;OPEN_BRACE>&gt;
Token('var', &lt;VAR>&gt;
Token('int', &lt;INT>&gt;
Token('x', &lt;IDENTIFIER>&gt;
Token(';', &lt;SEMICOLON>&gt;
Token('x', &lt;IDENTIFIER>&gt;
Token('=', &lt;ASSIGN>&gt;
Token('HLP_Random', &lt;IDENTIFIER>&gt;
Token('(', &lt;OPEN_PAREN>&gt;
Token('100', &lt;INTEGER_LITERAL>&gt;
Token(')', &lt;CLOSE_PAREN>&gt;
Token(';', &lt;SEMICOLON>&gt;
Token('if', &lt;IF>&gt;
Token('(', &lt;OPEN_PAREN>&gt;
Token('x', &lt;IDENTIFIER>&gt;
Token('>=', &lt;GREATER_THAN_EQUALS>&gt;
Token('50', &lt;INTEGER_LITERAL>&gt;
Token(')', &lt;CLOSE_PAREN>&gt;
Token('{', &lt;OPEN_BRACE>&gt;
Token('Print', &lt;IDENTIFIER>&gt;
Token('(', &lt;OPEN_PAREN>&gt;
Token('"You win!"', &lt;STRING_LITERAL>&gt;
Token(')', &lt;CLOSE_PAREN>&gt;
Token(';', &lt;SEMICOLON>&gt;
Token('}', &lt;CLOSE_BRACE>&gt;
Token('else', &lt;ELSE>&gt;
Token('{', &lt;OPEN_BRACE>&gt;
Token('Print', &lt;IDENTIFIER>&gt;
Token('(', &lt;OPEN_PAREN>&gt;
Token('"You lose"', &lt;STRING_LITERAL>&gt;
Token(')', &lt;CLOSE_PAREN>&gt;
Token(';', &lt;SEMICOLON>&gt;
Token('}', &lt;CLOSE_BRACE>&gt;
Token(';', &lt;SEMICOLON>&gt;
Token('}', &lt;CLOSE_BRACE>&gt;
Token(';', &lt;SEMICOLON>&gt;
			</code></pre>
			
			
						</div>
						<aside class="notes">
							Pierwszym krokiem jest analiza leksykalna
						</aside>
					</section>
					
					<section data-transition="slide">
						<h3>2. Parsing (syntactic analysis)</h3>
						
						<img class="fragment fade-in" src="antlr4_parse_tree.png" style="background: white;">
						
						<aside class="notes">
							Kolejnym krokiem jest analiza skadniowa (inaczej parsowanie)
						</aside>
					</section>
					
					
					<section data-transition="slide">
						<h3>3. Semantic analysis</h3>
						<pre class="fragment fade-in"><code data-trim data-noescape>
var int random;
radom = 5;
						</code></pre>
						<pre class="fragment fade-in"><code data-trim data-noescape>
var int num;
num = "five";
						</code></pre>
						<pre class="fragment fade-in"><code data-trim data-noescape>
var int x;
var int x;
						</code></pre>
						<pre class="fragment fade-in"><code data-trim data-noescape>
var C_NPC person;
person = HLP_GetNpc(PC_Thief_DI);
person.qold = 100;
						</code></pre>
						<pre class="fragment fade-in"><code data-trim data-noescape>
func int testFunc() {};
						</code></pre>
						<aside class="notes">
							Kolejnym krokiem jest analiza semantyczna
						</aside>
					</section>
					
					<section data-transition="slide">
						<h4>3. Intermediate representation generation</h4>
						
						<div class="fragment fade-in" style="align-items: center; display: flex;">
						<pre style="width:32%; float:left;  font-size: 0.50em;"><code data-trim data-noescape style="overflow: hidden;">
func void testFunc() {
  var int x;
<mark style="background: darkolivegreen;">  x = HLP_Random(100);</mark>
<mark style="background: darkslateblue;">  if (x >= 50)</mark>
<mark style="background: brown;">  {
    Print("You win!");
  }</mark>
<mark style="background: darkslategrey;">  else</mark>
<mark style="background: saddlebrown;">  {
    Print("You lose");
  };</mark>
<mark style="background: darkcyan;">};</mark>
			</code></pre>
			
			<p style="float: left;margin:0;padding: 0; font-size:100%"></p>
			
			<pre style="width:35%; float:left; font-size: 0.50em;"><code data-trim data-noescape style="overflow: hidden;">
<mark style="background: darkolivegreen;">PushInt(100)
CallExternal(HLP_Random)
PushVar(testFunc.x)
Assign()</mark>
<mark style="background: darkslateblue;">PushInt(50)
PushVar(testFunc.x)
GreaterOrEqual()
JumpIfToLabel("label_0")</mark>
<mark style="background: brown;">PushVar(10000)
CallExternal(Print)
JumpToLabel("label_1")</mark>
<mark style="background: darkslategrey;">AssemblyLabel("label_0")</mark>
<mark style="background: saddlebrown;">PushVar(10001)
CallExternal(Print)
AssemblyLabel("label_1")</mark>
<mark style="background: darkcyan;">Ret()</mark>
			</code></pre>
			
						<pre style="width:25%; float:left; font-size: 0.50em;"><code data-trim data-noescape style="overflow: hidden;">
<mark style="background:rgb(40,40,40);">HLP_Random
...
Print</mark>
testFunc
testFunc.x
10000 "You win"
10001 "You lose"
			</code></pre>
			
						</div>
						<aside class="notes">
							Generowanie formy poredniej, czyli uzupenienie struktur w kodzie danymi, z kt贸rych p贸藕niej w atwy spos贸b bdzie mo偶na wygenerowa kod bajtowy.
						</aside>
					</section>
					
					<section data-transition="slide">
						<h3>4. Code generation</h3>
						
						<img class="fragment fade-in-then-disappear" src="hxdhighlight.png">
						
						<div class="fragment fade-in" style="align-items: center; display: flex;">
						<pre style="width:35%; float:left; font-size: 0.50em; margin-left:15%;"><code data-trim data-noescape style="overflow: hidden;">
PushInt(100)
CallExternal(HLP_Random)
PushVar(testFunc.x)
Assign()
PushInt(50)
PushVar(testFunc.x)
GreaterOrEqual()
JumpIfToLabel("label_0")
PushVar(10000)
CallExternal(Print)
JumpToLabel("label_1")
AssemblyLabel("label_0")
PushVar(10001)
CallExternal(Print)
AssemblyLabel("label_1")
Ret()
						</code></pre>
						<p style="float: left;margin:0;padding: 0; font-size:100%"></p>
						<pre style="width:35%; float:left; font-size: 0.50em;  margin-right:15%;"><code data-trim data-noescape style="overflow: hidden;">
40 64 00 00 00
3E 57 02 00 00
41 AC 03 00 00
09
40 32 00 00 00
41 AC 03 00 00
12
4C 2F 00 00 00
41 AD 03 00 00
3E 0C 00 00 00
4B 39 00 00 00

41 AE 03 00 00
3E 0C 00 00 00

3C
						</code></pre>
						</div>
						
						
						<aside class="notes">
							Ostatnim krokiem jest wygenerowanie kodu, w naszym przypadku to bdzie kod bajtowy dla maszyny wirtualnej Gothica.
						</aside>
					</section>
					
					<section data-background-transition="slide">
						<h3>Let's make a compiler</h3><br>
						<h4 class="fragment fade-in" style="text-align:left;">Q: What do I need?</h3>
						<h4 class="fragment fade-in" style="text-align:left;">A: ANTLR4!</h3>
						<br><br>
						<aside class="notes">
						</aside>
					</section>
					

					
					
					
				</section>
				
				<section class="stack">
					<section>
						<h3>What our compiler can do for now moment ?</h3>
						<ul>
							<li class="fragment fade-in-then-semi-out" style="text-align:left">Load SRC file</li>
							<li class="fragment fade-in-then-semi-out" style="text-align:left">Compile Daedalus code and generate DAT file</li>
							<li class="fragment fade-in-then-semi-out" style="text-align:left">Detect errors with default ANTLR error strategy</li>
							<li class="fragment fade-in-then-semi-out" style="text-align:left">Generate CSL files ( Gothic Engine Dialog file )</li>
							<li class="fragment fade-in-then-semi-out" style="text-align:left">Generate readable assembler (WIP)</li>
						</ul>

						<aside class="notes">
							Nad kompilatorem pracujemy ju偶 okoo 9 miesicy, przez ten czas udao nam si ju偶 troch osign.

							Udao nam si z suksecem zaadowa pene skrypty Gothica II i wygenerowa plik DAT kt贸ry jest taki sam jak plik tworzony przez oryginalny kompilator. Dodatkowo nasz kompilator jest szybszy od oryginalnego.

							Dziki antlr'owi mamy zaimplementowane wykrywanie bd贸w leksykalnych i semantycznych. Pracujemy nad ulepszeniem wykrywanie bd贸w semantycznych, poniewa偶 nie wszystkie da si wyapa podczas procesu parsowania

							Generujemy pliki CSL. S one tworzone na podstawie komenatrzy kt贸re s w kodzie. WIem 偶e to do dziwaczne trzyma w komentarzach dialogi ale byo to wymylane w 1999.

							Gdy dodamy odpowedni flag zamiast pliku DAT generujemy poredni assembler, kt贸ry jest w peni czytelny przez czowieka, ten feature wymaga dopracowania.

						</aside>
					</section>
					<section>
						<h3>Demo</h3>
						<img class="fragment fade-in-then-semi-out" src="demo.gif">

						<aside class="notes">
							Teraz czas na demo :). Dla pewnoci zrobiem nagranie terminala w postaci GIFa. Zobaczmy co na nim jest

							Na pocztku tworzymy plik Gothic.src, plik ten zawiera inforamcji o lokalizacji naszych wszystkich 藕r贸de.
							Nastpnie dodajemy plik z Daedalusem, dodajemy w nim testow funkcj, robimy operacje na lokalnej zmiennej

							Dalej kompilujemy plik src kompilatorem, kompilator m贸wi nam o braku rednika

							Poprawiamy to, kompilujemy jeszcze raz, tym razem kompilator kompiluje z sukcesem i generuje folder output

							W nim znadjuje si plik DAT, plik DAT jest plikiem binarnym z kodem maszynowym.
						</aside>
					</section>
					<section style="font-size: 80%">
						<h3>Some interesting problems during development</h3>
						<li class="fragment fade-in-then-semi-out" style="text-align:left">
							Problem with encoding ( Gothic Script were written originally written in windows 1250 encoding  )
						</li>
						<li class="fragment fade-in-then-semi-out" style="text-align:left">
							Problem with INSTANCE_HELP symbol name ( in byte code it's prefixed with fixed char, value of that char is 255  )
							<br/><br/><img width="400" src="instanceHelpProblem.png">
						</li>
						<li class="fragment fade-in-then-semi-out" style="text-align:left">
							Problem with slow compilation speed ( changing List to Dictionary resolved problem  )
						</li>
						<li class="fragment fade-in-then-semi-out" style="text-align:left">
							dotNet Directory.GetFiles method by default works differently on different OS
						</li>

						<aside class="notes">
							Podczas developmentu napotkalimy kilka ciekawych problem贸w.

							Odkrylimy, 偶e skrypty gothica nie s kodowane w utf8, a w windows 1250. Pod koniec lat 90 utf8 nie byo jeszcze
							tak popularne. Na szczcie w netcore w prosty spos贸b mo偶na wczyta stringa w kodowaniu 1250, tak samo w prosty spos贸b
							mo偶na przekonwertowa spowrotem stringa do 1250

							Napotkalimy na problem z nazw zmiennej w wynikowym pliku DAT. Mianowicie po kompilacji zmienna ta dostawaa nowy znak do nazwy.
							Nasz kompilator czego takiego nie robi, skd wyszy niezgodnoci midzy naszym DATem, a DATem oryginlnaego kompilatora,
							prostym IFem naprawilimy problem, na szczcie to jedyny taki przypadek z dodawaniem prefix贸w przez kompilator

							W pierwszych wersjach nasz kompilator strasznie powoli dziaa, okazao si 偶e problem jest podczas przeszukiwania
							listy z symbolami, zamiana tej偶e listy na sownik przyspieszya proces kompilacji kilkukrtonie

							Podczas test贸w na MacOS napotkaem na problemy. Okazao si 偶e pliki s czytane w innej kolejnosci ni偶 na windowsie, a
							to ma ogromne znaczenie podczas kompilacji, bo musi by zachowana prawidowa kolejno parsowania plik贸w,
							problem wynika z wildcard贸w kt贸re s wspierane w plikach SRC. Funckja Directory.GetFiles jako jeden z argument贸w ma
							pattern, w kt贸rym mozemy poda wildecard, na windowsie gdy mamy sytuacje 偶e nazwa pliku jest prefixem innego pliku,
							to na posortowanej licie pierwszy bdzie plik o du偶szej nazwie, na macOS dziaa to odwrotnie, pierwszy na licie bdzi
							plik o kr贸tszej nazwie, ten kt贸ry jest prefixem
						</aside>
					</section>
					<section>
						<h3>Things about Daedalus discovered during compiler development</h3>
						<li class="fragment fade-in-then-semi-out" style="text-align:left">
							Operation on floats are limited
						</li>
						<li class="fragment fade-in-then-semi-out" style="text-align:left">
							Statement of IF block does't have to be surrounded with brackets, ex:
							<pre><code data-trim data-noescape>
if 5 < 2 {
};
							</code></pre>
						</li>
						<li class="fragment fade-in-then-semi-out" style="text-align:left">
							Gothic Compiler support expression without assigment
							<pre><code data-trim data-noescape>
if ( a > b ) {
  b;
};
							</code></pre>
						</li>

						<aside class="notes">
							Dziki pracy nad kompilatorem udao nam si dowiedzie kilka ciekawych rzeczy.

							Obsuga float贸w jest bardzo kiepska. De facto to g贸wnie su偶 jako parametry do r贸偶nych rzeczy w silniku.
							Nie ma na poziomie VM instukcji kt贸re pozwalayby robi por贸wnania float贸w, czy te偶 operacji dodawania etc

							Nie jest wymogiem dawanie nawias贸w do wyra偶e w blokach warunkowych. Na pocztku mylelimy 偶e jest to jaki bug
							oryginlnaego kompilatra 偶e na co takiego pozwala, ale jak si p贸藕niej okazao to jednak feature ;). De facto
							tylko w jednym wyra偶eniu tw贸rcy gothica pokusili si o tak skadni.

							W gothicu dozwolne jest u偶ycie wyra偶enia w kt贸rym podajemy sam praw warto, w takim przypadku po prostu
							na stos jest wrzucana zmienna b, i nic wiecej. De facto taki kod nic nie robi, tak偶e troch nie ma sensu,
							w oryginlnych skryptach gothica jest tylko takie jedno miejsce z takim expression
						</aside>
					</section>
					<section>
						<h3>What we plan to add ?</h3>
						<ul>
							<li class="fragment fade-in-then-semi-out" style="text-align:left">
								Better error handling
								<ul>
									<li>Lexical errors</li>
									<li>Semantic errors</li>
								</ul>
							</li>
							<li class="fragment fade-in-then-semi-out" style="text-align:left">
								Add booleans ( software support )
							</li>
							<li class="fragment fade-in-then-semi-out" style="text-align:left">
								Add loops (for, while, foreach)
							</li>
							<li class="fragment fade-in-then-semi-out" style="text-align:left">
								Possibility to define methods in classes
							</li>
							<li class="fragment fade-in-then-semi-out" style="text-align:left">
								Add translation string ( feature needed for translation tool )
							</li>
							<li class="fragment fade-in-then-semi-out" style="text-align:left">
								Add operations on float ( software support )
							</li>
							<li class="fragment fade-in-then-semi-out" style="text-align:left">
								And ... features suggested by You, community and all Daedalus users ;)
							</li>
						</ul>

						<aside class="notes">
							Planujemy rozszerzy Daedalus o kilka istotnych funkcji.

							Chcielibymy ulepszy wylrywanie bd贸w. Obecnie nie robimy analizy typ贸w, co jest must have.
							Dodatkowo mylimy nad zmian domylnej strategi antlr zwizanej z detekcj bd贸w podczas
							parsowania kodu, dziki czemu moglibymy mie bardziej customow obsug bd贸w.

							Doda booleany. Niestety nie jest to mo偶liwe na poziomie VM, tak偶e pod spodem byyby
							dalej inty

							Doda ptle, co ciekawe tw贸rcy nie zdecydowali si na ich dodanie, w niekt贸rych miejscach
							takowe ptle uprociyby kod skrytp贸w

							Mo偶liwo dodawania metod do klas, na dzie obecny mo偶na jedynie dodawa pola z wartociami do klas

							Obecnie niekt贸re teksty ktr贸re s wyswietlane w grze s trzymane jako literay Daedalusa. Przez to
							tumacz musi grzeba w rzeczach abstrakcyjnych dla niego i dodatkowo mo偶e popsu skrypty. Planujemy
							doda mechanizm kt贸ry pozwoli wycigna te teksty do zewntrznych plik贸w

							Planujemy doda mo偶liwo operacji na floatach, dziki temu skrypterzy mieliby wiksze mo偶liwoci

							Tak偶e wy mo偶ecie zadecydowa co chcecie zobaczy w nowym Daedalusie. Jestemy otwarci na sugestie
						</aside>
					</section>
				</section>
				<section class="stack">
					<section style="font-size: 90%">
						<h3>Do we write tests ?</h3> <br/>
						<img class="fragment fade-in" width="500" src="testMeme.jpg"><br/>
						<h3 class="fragment fade-in">Just kidding!</h3>
						<h3 class="fragment fade-in">Yes, we do!</h3>
						<h3 class="fragment fade-in">And their helped us!!</h3>

						<aside class="notes">
							Pewnie si zastanawialicie si czy piszemy testy.

							Po cholere je pisa ...

							Nie no, 偶art, piszemy testy

							I myl 偶e warto, mielimy sytaucje 偶e robilimy refactor, dziki testom byo to o wiele atwieszje. Mamy te偶 wiksz
							pewno 偶e nowe featury nie zepsuj obecnie dziajajych rzeczy. Dodatkowo po du偶szej przerwie z kodem spogldajc na
							testy, mo偶e sobie przypomnie jak wyglda i dziaa assembler VM daedalusa
						</aside>
					</section>
					<section>
						<h3>We write unit tests</h3>
						<img width="800" class="fragment fade-in" src="unitTest.png">
						<aside class="notes">
							W unit testach wikszo test cas贸w ma kod w stringu Daedalusa oraz oczekiwane instrukcje kodu poredniego,
							w tecie uruchamiamy kompilator dla tego stringa i sprawdzamy czy instrukcje IR s takie jakie powinny by wygenerowane
						</aside>
					</section>
					<section>
						<h3>We write e2e tests</h3>
						<img src="e2eTest.png">
						<aside class="notes">
							W testach e2e midzyinnymi por贸wnujemy czy plik DAT stworzony przez oryginalengo gothica jest zgodny
							z plikiem DAT stworzonym przez nas
						</aside>
					</section>
					<section>
						<h3>We use CircleCI for automation</h3>
						<img src="circleci.png">
						<aside class="notes">
							Projekt trzymamy na Githubie, dziki circleCi mo偶emy w bardzo prosty spos贸b odpala testy za ka偶dym razem gdy robimy
							merge, albo wysyamy kod na dany branch
						</aside>
					</section>
					<section>
						<h3>Thanks to:</h3>
						<img width="300" src="dotnetcore.png">
						<div class="fragment fade-in">
							<h3>We can run compiler on:</h3>
							<img width="600" src="OS.png">
						</div>
						<aside class="notes">
							Dziki temu 偶e kompilator jest pisany w technologii dotnet core mo偶emy uruchomi go na wszystkich znaczych systemach.
							Wczeniej byo to mo偶liwe na windowsie, poniewa偶 kompilator jest wbudowany w gothic2.exe, a gothic2.exe dziaa tyko na windowsie,
							zapominajc o tym 偶e jest co takiego jak wine, uruchomienie na wine wymaga troch kombinacji
						</aside>
					</section>
				</section>
				
				<section>
					<h3>We need C# programmers</h3>
				</section>
				
				<section>
					<h3>Thank you and Bye</h3> <br />
					<h3 class="fragment fade-in">Questions ?</h3>
					<br /><br />
					<img width="200" src="ghLogo.png"><br/>
					<a href="https://github.com/dzieje-khorinis/DaedalusCompiler">github.com/dzieje-khorinis/DaedalusCompiler</a>
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});

			// setTimeout(() => {
            //   Reveal.navigateTo(4)
			// }, 500);
		</script>
	</body>
</html>
